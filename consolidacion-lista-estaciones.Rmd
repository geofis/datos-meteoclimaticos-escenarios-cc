---
title: "Consolidación de listas de estaciones"
author: "José Ramón Martínez Batlle"
output:
  # pdf_document:
  #   latex_engine: xelatex
  html_document
  # github_document
editor_options: 
  chunk_output_type: console
always_allow_html: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  cache = FALSE, 
  echo = TRUE,
  warning = FALSE,
  message = FALSE)
```

## Paquetes

```{r}
library(sf)
library(leaflet)
library(mapview)
library(readODS)
library(readxl)
library(parzer)
library(tidyverse)
library(kableExtra)
library(pdftools)
library(datapasta)
source('R/funciones.R')
```

## INDRHI

```{r}
indrhi_telemetricas <- read_ods('fuentes/indrhi/Red_Telem_Estacion_Coord-Sept2015.ods')
(indrhi_telemetricas$longitudOK <- indrhi_telemetricas$LONGITUDE)
(indrhi_telemetricas$latitudOK <- indrhi_telemetricas$LATITUDE)
indrhi_telemetricas$idOK <- indrhi_telemetricas$`STATION SITE`
indrhi_telemetricas %>%
  kable(booktabs=T) %>%
  kable_styling(latex_options = c("HOLD_position", "scale_down"))
indrhi_historico <- read_excel(
  path = 'fuentes/indrhi/Listado Red Medicion INDRHI_Historico_24-10-2022_revision_jr.xlsx'
  )
indrhi_historico$longitudOK <- 0 - parse_lon(indrhi_historico$LONGITUD)
head(indrhi_historico$longitudOK, 50)
indrhi_historico$latitudOK <- parse_lon(indrhi_historico$LATITUD)
head(indrhi_historico$latitudOK, 50)
indrhi_historico$idOK <- indrhi_historico$ESTACION
indrhi_historico[1:130, ] %>%
  kable(booktabs=T) %>%
  kable_styling(latex_options = c("HOLD_position", "scale_down"))
```

## Fundación REDDOM

```{r}
reddom <- read_excel(path = 'fuentes/reddom/Localizacion Estaciones Meterologicas CLIMARED_LT.xlsx',
                     skip = 2, col_names = T)
colnames(reddom) <- gsub('(^[0-9]$)', 'Temperatura-Humedad Suelo \\1', colnames(reddom))
(reddom$longitudOK <- reddom$Longitud)
(reddom$latitudOK <- reddom$Latitud)
reddom$idOK <- reddom$NOMBRE
reddom %>% 
  kable(booktabs=T) %>%
  kable_styling(latex_options = c("HOLD_position", "scale_down"))
```

## INTEC

```{r}
intec <- read_excel(path = 'fuentes/intec/Lista estaciones meteorológicas OCCR.xlsx',
                    skip = 7, col_names = T)
colnames(intec) <- c(colnames(intec)[c(1, 2)], c('longitud', 'latitud'), colnames(intec)[c(5, 6)])
(intec$longitudOK <- parse_lon(intec$longitud))
(intec$latitudOK <- parse_lat(gsub('\\. ', '\\.', intec$latitud)))
intec$Marca <- intec$Marca[1]
intec$`Parámetros que miden` <- intec$`Parámetros que miden`[1]
intec$idOK <- intec$Ubicación
intec %>% 
  kable(booktabs=T) %>%
  kable_styling(latex_options = c("HOLD_position", "scale_down"))
```

## Guakia

```{r}
guakia <- read_ods('fuentes/guakia/estaciones_guakia.ods')
(guakia$longitudOK <- guakia$LONGITUDE)
(guakia$latitudOK <- guakia$LATITUDE)
guakia$idOK <- guakia$IDENTIFICADOR
guakia %>%
  kable(booktabs=T) %>%
  kable_styling(latex_options = c("HOLD_position", "scale_down"))
```


## Consolidado

```{r}
lista_estaciones <- list(
  indrhi_telemetricas = indrhi_telemetricas,
  indrhi_historico = indrhi_historico,
  intec = intec,
  reddom = reddom,
  guakia = guakia)
consolidado_estaciones <- bind_rows(lista_estaciones, .id = 'fuente')[, c('fuente', 'idOK', 'longitudOK', 'latitudOK')]
consolidado_estaciones[sample(seq_len(nrow(consolidado_estaciones)), 30), ] %>% 
  kable(booktabs=T) %>%
  kable_styling(latex_options = c("HOLD_position", "scale_down"))
consolidado_estaciones_sf <- st_as_sf(
  consolidado_estaciones[!with(consolidado_estaciones, is.na(longitudOK) | is.na(latitudOK)), ],
  coords = c('longitudOK', 'latitudOK'))
nrow(consolidado_estaciones_sf)
table(consolidado_estaciones_sf$fuente) %>%
  kable(booktabs=T, col.names = c('Fuente', 'Número de estaciones')) %>%
  kable_styling(latex_options = c("HOLD_position"))
```

## Mapa datos 2022

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'gfm-yaml_metadata_block') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-datos-2022)'`

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'latex') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-datos-2022)'`

```{r, fig.width=8, dpi=100, out.width="100%"}
fpal <- colorFactor(
  palette = RColorBrewer::brewer.pal(length(unique(consolidado_estaciones_sf$fuente)), 'Set1'),
  domain = unique(consolidado_estaciones_sf$fuente))
leaflet(consolidado_estaciones_sf) %>%
  addCircleMarkers(
    radius = 5, label = ~ idOK, group = ~ fuente,
    color = ~ fpal(fuente),
    stroke = FALSE, fillOpacity = 0.8
  ) %>%
  addLegend(pal = fpal, values = ~ fuente, opacity = 1) %>% 
  addTiles(group = 'OSM') %>%
  addProviderTiles("Esri.NatGeoWorldMap", group="ESRI Mapa") %>%
  addProviderTiles("Esri.WorldImagery", group="ESRI Imagen") %>%
  addProviderTiles("CartoDB.Positron", group= "CartoDB") %>%
  addLayersControl(
    baseGroups = c("OSM", "ESRI Mapa", "CartoDB", "ESRI Imagen"),
    overlayGroups = ~ fuente, position = 'bottomright',
    options = layersControlOptions(collapsed = FALSE)) %>% 
  setView(lat = 18.7, lng = -70.5, zoom = 7)
```

## Consolidación estaciones INDRHI, ONAMET, REDDOM

### Telemétricas INDRHI

```{r, echo=F}
nombres_columnas <- c("No.", "NOMBRE DE ESTACIÓN", "X", "Y", "CUENCA", "TIPO ESTACIÓN", "CONDICIONES")
afd_indrhi_telem_1 <- data.frame(
    stringsAsFactors = FALSE,
                 No. = c(1L,2L,3L,4L,5L,6L,7L,
                         8L,9L,10L,11L,12L,13L,14L,15L,16L,17L,18L,
                         19L,20L,21L,22L,23L,24L,25L,26L,27L,28L,29L,
                         30L,31L,32L,33L,34L),
  NOMBRE.DE.ESTACIÓN = c("Alto Bandera",
                         "Baiguaque Los  Pilones","Bao Agua Caliente","Camú - Bayacanes",
                         "Cañafistol","Cenovi","Contraembalse de  López",
                         "Contraembalse Las  Barías","Contraembalse  Monción",
                         "El Aguacate","El Arroyaso","El Cacheo","El Limón",
                         "El Popote","Guanajuma el  Cerrazo",
                         "Guarey - Presa  Guaigui","Inoa","Instituto Isa","Jagua Los Limones",
                         "Jarabacoa","Jima Abajo","Jima Cañada de  Piedra",
                         "José Contreras","Juan Adrián (Los  Plátanos)","Juma",
                         "La bija","La Ceiba","La Cidra","La Ciénaga, Manabao",
                         "La Diferencia","La Guama","Lago Enriquillo",
                         "Las Matas de Santa  Cruz","Los Almácigos"),
                   X = c("328604","330054",
                         "300367","333306.57","262106","265929.49","319847",
                         "367775","280718","339563","337128","276980",
                         "414000","275866","316725","344424.35","291926.81",
                         "345120","302567","331115","354699","349195",
                         "350480","359657.5835","354006","354006","335918",
                         "255724","303919","285121","308836","382924","342232",
                         "310063"),
                   Y = c("2080646","2129922",
                         "2128746","2127159.55","2090450","2137556.51",
                         "2140291","2029388","2151425","2167688","2104337",
                         "2082101","2117960","2092580","2131773","2084416.72",
                         "2140900.88","2077243","2121495","2115122",
                         "2115579","2103097","2168348","2075037.612","2090084",
                         "2168348","2089896","2130735","2109276","2131441",
                         "2071796","2121411","2173352","2159145"),
              CUENCA = c("Rio Nizao",
                         "Rio Baiguaque","Rio Bao","Rio Camú","San Juan","Rio Cenovi",
                         "Rio Yaque del  Norte","Rio Nizao","Rio Mao",
                         "Yaque del Sur","Rio Yaque del  Norte","Yaque del Sur",
                         "Rio Yuna","Yaque del Sur","Rio Guanajuma","Rio Camú",
                         "Rio Inoa","Rio Yaque del  Norte","Rio Jagua",
                         "Rio Yaque del  Norte","Rio Jima","Rio Jima","Rio Cenovi",
                         "Rio Maimón","Rio Yuboa","Rio Yuna","Rio La Ceiba",
                         "Rio La Cidra","Rio Yaque del  Norte","Rio Maguá",
                         "Yaque del Sur","Hoya Lago  Enriquillo","Rio Guayubin",
                         "Los Almácigos"),
       TIPO.ESTACIÓN = c("climática","hidrométrica",
                         "hidrométrica","hidrométrica","Hidrométrica",
                         "climática","presa+clim","presa+clim","presa+clim",
                         "Hidrométrica","pluviométrica","Hidrométrica",
                         "hidrométrica+clim","Climática","hidrométrica","presa+CA+clim",
                         "hidrométrica","climática","hidrométrica",
                         "climática","hidrométrica","hidrométrica","climática",
                         "pluviométrica","climática","hidrométrica","pluviométrica",
                         "pluviométrica","hidrométrica","climática",
                         "Hidro+Pluvio+Sonda","presa+clim","pluviométrica",
                         "hidrométrica"),
         CONDICIONES = c("Funcionando",
                         "No funcionando","No funcionando","No funcionando",
                         "No funcionando","No funcionando","No funcionando","Funcionando",
                         "No funcionando","No funcionando","No funcionando",
                         "No funcionando","No funcionando","Funcionando",
                         "No funcionando","Funcionando","No funcionando",
                         "Funcionando","No funcionando","Funcionando",
                         "No funcionando","No funcionando","No funcionando","Funcionando",
                         "No funcionando","Funcionando","No funcionando",
                         "Funcionando","Funcionando","No funcionando",
                         "No funcionando","No funcionando","Funcionando","No funcionando")
)
colnames(afd_indrhi_telem_1) <- nombres_columnas

afd_indrhi_telem_2 <- data.frame(
    stringsAsFactors = FALSE,
                 No. = c(35L,36L,37L,38L,39L,
                         40L,41L,42L,43L,44L,45L,46L,47L,48L,49L,50L,
                         51L,52L,53L,54L,55L,56L,57L,58L,59L,60L,61L,
                         62L,63L,64L,65L,66L,67L,68L,69L,70L,71L,72L,
                         73L),
  NOMBRE.DE.ESTACIÓN = c("Los Bancos","Los Botados",
                         "Los Pinales","Magua Monción","Mahoma El Rosalito",
                         "Mahomita el Cacao","Mao La Cidra","Mao Meseta",
                         "Masipedro Los Arroces","Mata Grande","Nizao Bocaina",
                         "Palo Verde","Palomino","Paso de Lima",
                         "Peña Ranchadero","Pimentel","Pinalito, Constanza",
                         "Presa de Tireito","Presa de Aguacate","Presa de Blanco",
                         "Presa de Chacuey","Presa de Hatillo","Presa de Jiguey",
                         "Presa de Maguaca","Presa de Monción",
                         "Presa de Monte Grande","Presa de Rincón","Presa de Sabana Yegua",
                         "Presa de Sabaneta","Presa de Tavera","Presa de Valdesia",
                         "Puente La Barca","Puente San Rafael (Mao)","Ranchito",
                         "Resbaloso","Rincón","Sabana Alta","Tamayo",
                         "Valle de Bao"),
                   X = c(282608L,332820L,264013L,
                         275219L,355528L,362807L,316109L,266154L,347054L,
                         394799L,346075L,231743L,291962L,257967L,255610L,
                         384728L,328756L,339659L,260706L,335411L,233506L,
                         370404L,254763L,235606L,277602L,287144L,352260L,
                         284116L,258912L,315508L,364311L,385002L,283911L,
                         354186L,231575L,249209L,277628L,257761L,285724L),
                   Y = c(2066453L,2087095L,
                         2116476L,2145679L,2055823L,2048883L,2137284L,2142133L,
                         2098779L,2121411L,2065121L,2186781L,2080064L,
                         2105849L,2175469L,2122238L,2092323L,2085928L,2045187L,
                         2088794L,2171536L,2100046L,2050922L,2171597L,2147187L,
                         2048398L,2113341L,2070157L,2099808L,2132677L,
                         2033532L,2118236L,2167073L,2121286L,2149596L,2160295L,
                         2071678L,2024506L,2109683L),
              CUENCA = c("Yaque del Sur","Rio Yuna",
                         "San Juan","Rio Maguá","Rio Mahoma","Rio Mahomita",
                         "Rio Mao","Rio Mao","Rio Masipedro",
                         "Rio Yaque del  Norte","Rio Nizao","Rio Yaque del  Norte",
                         "Yaque del Sur","San Juan","Rio Yaque del  Norte","Rio Yuna",
                         "Rio Yuna","Rio Tireito","Rio Nizao","Rio Blanco",
                         "Rio Chacuey","Rio Yuna","Rio Nizao","Rio Maguaca",
                         "Rio Mao","Yaque del Sur","Rio Jima",
                         "Yaque del Sur","San Juan","Rio Yaque del  Norte","Rio Nizao",
                         "Rio Yuna","Rio Yaque del  Norte","Rio Yuna",
                         "Rio Inaje","Rio Guayubín","San Juan","Yaque del Sur",
                         "Rio Bao"),
       TIPO.ESTACIÓN = c("Hidro+Pluvio+Sonda",
                         "climática","Climática","pluviométrica","hidrométrica",
                         "hidrométrica","hidrométrica","hidrométrica",
                         "hidrométrica","climática","hidrométrica","hidrométrica",
                         "Hidro+Pluvio+Sonda","Hidro+Pluvio+Sonda",
                         "hidrométrica","hidrométrica","hidrométrica","presa+clim",
                         "presa+clim","presa+clim","presa+clim","presa+CA+clim",
                         "presa+clim","presa+clim","presa+CA+clim",
                         "Hidro+Climática+Sonda","presa+CA+clim","Hidro+Climática+Sonda",
                         "Hidro+Climática+Sonda","presa+CA+clim",
                         "presa+CA+clim","Hidrométrica (SONDA)","hidrométrica",
                         "hidrométrica","pluviométrica","hidrométrica","Hidrométrica",
                         "Climática","pluviométrica"),
         CONDICIONES = c("No funcionando",
                         "No funcionando","No funcionando","Funcionando",
                         "No funcionando","No funcionando","No funcionando",
                         "No funcionando","No funcionando","Funcionando","No funcionando",
                         "No funcionando","Funcionando","Funcionando",
                         "No funcionando","No funcionando","No funcionando",
                         "Funcionando","No funcionando","No funcionando",
                         "No funcionando","No funcionando","No funcionando",
                         "No funcionando","No funcionando","No funcionando",
                         "No funcionando","No funcionando","Funcionando","Funcionando",
                         "Funcionando","Funcionando","No funcionando",
                         "No funcionando","Funcionando","No funcionando",
                         "No funcionando","No funcionando","Funcionando")
)
colnames(afd_indrhi_telem_2) <- nombres_columnas

afd_indrhi_telem_3 <- data.frame(
    stringsAsFactors = FALSE,
                 No. = c(74L, 75L, 76L, 77L, 78L, 79L, 80L),
  NOMBRE.DE.ESTACIÓN = c("Valle del Tetero",
                         "Yaque del Norte Boma","Yaque del Norte Manabao",
                         "Yuna La Verde","Yuna Platanal","Presa de Tavera",
                         "Loyola - Dajabón"),
                   X = c("296888","323927",
                         "311918","354321","382924","315508","216868.46"),
                   Y = c("2100471","2121432",
                         "2110080","2096692","2114381","2132677","2163447"),
              CUENCA = c("Yaque del Sur",
                         "Rio Yaque del  Norte","Rio Yaque del  Norte","Rio Yuna",
                         "Rio Yuna","Rio Yaque del  Norte","Dajabón"),
       TIPO.ESTACIÓN = c("Climática","hidrométrica",
                         "hidrométrica+clim","hidrométrica","hidrométrica",
                         "presa+CA","climática"),
         CONDICIONES = c("No funcionando",
                         "No funcionando","No funcionando","No funcionando",
                         "No funcionando","No funcionando","No funcionando")
)
colnames(afd_indrhi_telem_3) <- nombres_columnas
afd_indrhi_telem <- rbind(afd_indrhi_telem_1, afd_indrhi_telem_2, afd_indrhi_telem_3)
# Conteos, proporciones
afd_indrhi_telem_cond_n <- table(afd_indrhi_telem$CONDICIONES)
afd_indrhi_telem_cond_pct <- prop.table(afd_indrhi_telem_cond_n)*100
afd_indrhi_telem$CONDICIONES <- factor(afd_indrhi_telem$CONDICIONES,
       labels = c(
         paste0('Funcionando, ', afd_indrhi_telem_cond_n[[1]], ' (', afd_indrhi_telem_cond_pct[[1]], '%)'),
         paste0('No funcionando, ', afd_indrhi_telem_cond_n[[2]], ' (', afd_indrhi_telem_cond_pct[[2]], '%)')))
```

<!-- #### sf -->

```{r, echo=F}
afd_indrhi_telem[, c('X', 'Y')] <- sapply(afd_indrhi_telem[, c('X', 'Y')], as.numeric)
afd_indrhi_telem_sf <- st_as_sf(
  afd_indrhi_telem, coords = c('X', 'Y'), crs = 32619) %>% 
  st_transform(4326)
afd_indrhi_telem_sf
```

#### Mapa de estaciones telemétricas INDRHI estudio AFD

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'gfm-yaml_metadata_block') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-telemétricas-indrhi-estudio-afd)'`

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'latex') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-telemétricas-indrhi-estudio-afd)'`


```{r, echo=F, fig.width=8, dpi=100, out.width="100%"}
fpal_condiciones <- colorFactor(
  palette = RColorBrewer::brewer.pal(length(unique(afd_indrhi_telem_sf$CONDICIONES)), 'Set1'),
  domain = unique(afd_indrhi_telem_sf$CONDICIONES))
leaflet(afd_indrhi_telem_sf) %>%
  addCircleMarkers(
    radius = 5, label = ~ `NOMBRE DE ESTACIÓN`, group = ~ CONDICIONES,
    color = ~ fpal_condiciones(CONDICIONES),
    stroke = FALSE, fillOpacity = 0.8
  ) %>%
  addLegend(pal = fpal_condiciones, values = ~ CONDICIONES, opacity = 1,title = "\"Estudio AFD\"<br>INDRHI<br>Telemétricas<br>CONDICIONES") %>% 
  addTiles(group = 'OSM') %>%
  addProviderTiles("Esri.NatGeoWorldMap", group="ESRI Mapa") %>%
  addProviderTiles("Esri.WorldImagery", group="ESRI Imagen") %>%
  addProviderTiles("CartoDB.Positron", group= "CartoDB") %>%
  addLayersControl(
    baseGroups = c("OSM", "ESRI Mapa", "CartoDB", "ESRI Imagen"),
    overlayGroups = ~ CONDICIONES, position = 'bottomright',
    options = layersControlOptions(collapsed = FALSE)) %>% 
  setView(lat = 18.7, lng = -70.5, zoom = 7)
```

### Meterológicas ONAMET

```{r, echo=F}
nombres_columnas <- c("No.", "ESTACION", "PROVINCIA", "LATITUD", "LONGITUD", "ELEVACIÓN")
afd_onamet_clim_func_1 <- data.frame(
  stringsAsFactors = FALSE,
               No. = c(1L,2L,3L,4L,5L,6L,7L,8L,
                       9L,10L,11L,12L,13L,14L,15L,16L,17L,18L),
          ESTACION = c("AZUA","PERALTA",
                       "PADRE LAS CASAS","TAMAYO","NEYBA","CABRAL","BARAHONA","POLO",
                       "RESTAURACION","DAJABON","SANTO DOMINGO","CEVICOS",
                       "VILLA RIVA","PIMENTEL","SAN F. MACORIS","EL SEIBO",
                       "MICHES","ELIAS PINA"),
         PROVINCIA = c("AZUA","AZUA","AZUA",
                       "BAHORUCO","BAHORUCO","BARAHONA","BARAHONA","BARAHONA",
                       "DAJABON","DAJABON","DISTRITO NACIONAL","DUARTE","DUARTE",
                       "DUARTE","DUARTE","EL SEIBO","EL SEIBO",
                       "ELIAS PINA"),
           LATITUD = c("18.450N","18.346N","18.733N",
                       "18.383N","18.467N","18.250N","18.200N","18.067N",
                       "19.317N","19.550N","18.483N","19.000N","19.167N",
                       "19.183N","19.283N","18.767N","18.983N","18.867N"),
          LONGITUD = c("70.733W","70.455W","70.933W",
                       "71.217W","71.417W","71.217W","71.100W","71.283W",
                       "71.683W","71.700W","69.917W","69.967W","69.900W",
                       "70.100W","70.250W","69.033W","69.050W","71.700W"),
         ELEVACIÓN = c(76L,516L,510L,21L,10L,19L,
                       10L,703L,594L,36L,14L,90L,17L,37L,110L,87L,3L,
                       387L)
)
colnames(afd_onamet_clim_func_1) <- nombres_columnas
afd_onamet_clim_func_2 <- data.frame(
  stringsAsFactors = FALSE,
               No. = c(19L,20L,21L,22L,23L,24L,
                       25L,26L,27L,28L,29L,30L,31L,32L,33L,34L,35L,36L,
                       37L,38L,39L,40L,41L,42L,43L,44L,45L,46L,47L,
                       48L,49L,50L,51L,52L,53L,54L,55L,56L,57L,58L,
                       59L,60L,61L,62L,63L,64L,65L,66L,67L),
          ESTACION = c("HONDO VALLE","MOCA",
                       "GASPAR HDEZ.","HATO MAYOR","S.DE LA MAR","DUVERGE","JIMANI",
                       "LA DESCUBIERTA","HIGUEY","SAN R. YUMA","PUNTA CANA",
                       "LA ROMANA","CONSTANZA","LA CASTILLA","LA VEGA",
                       "JARABACOA","CABRERA","RIO SAN JUAN","NAGUA","BONAO",
                       "MONTE CRISTI","PEPILLO SALCEDO","VILLA VASQUEZ",
                       "BAYAGUANA","MONTE PLATA","YAMASA","OVIEDO","PEDERNALES",
                       "ENRIQUILLO","BANI","SAN JOSE OCOA","RANCHO ARRIBA",
                       "IMBERT","ALTAMIRA","YASICA","LUPERON","A. LA UNION",
                       "SALCEDO","SANCHEZ","ARROYO BARRIL","SAMANA",
                       "SAN CRISTOBAL","LOYOLA","V. ALTAGRACIA","SAN JUAN","EL CERCADO",
                       "LAS MATAS FARFAN","LOS LLANOS","SAN P. MACORIS"),
         PROVINCIA = c("ELIAS PINA","ESPAILLAT",
                       "ESPAILLAT","HATO MAYOR","HATO MAYOR","INDEPENDENCIA",
                       "INDEPENDENCIA","INDEPENDENCIA","LA ALTAGRACIA",
                       "LA ALTAGRACIA","LA ALTAGRACIA","LA ROMANA","LA VEGA",
                       "LA VEGA","LA VEGA","LA VEGA","MARIA T. SANCHEZ",
                       "MARIA T. SANCHEZ","MARIA T. SANCHEZ","MONSEÑOR NOUEL",
                       "MONTE CRISTI","MONTE CRISTI","MONTE CRISTI","MONTE PLATA",
                       "MONTE PLATA","MONTE PLATA","PEDERNALES","PEDERNALES",
                       "PEDERNALES","PERAVIA","PERAVIA","PERAVIA","PUERTO PLATA",
                       "PUERTO PLATA","PUERTO PLATA","PUERTO PLATA",
                       "PUERTO PLATA","HERMANAS MIRABAL","SAMANA","SAMANA","SAMANA",
                       "SAN CRISTOBAL","SAN CRISTOBAL","SAN CRISTOBAL",
                       "SAN JUAN","SAN JUAN","SAN JUAN","SAN P. MACORIS",
                       "SAN P. MACORIS"),
           LATITUD = c("18.717N","19.383N","19.617N",
                       "18.750N","19.050N","18.367N","18.483N","18.567N",
                       "18.600N","18.417N","18.567N","18.417N","18.900N",
                       "18.967N","19.217N","19.117N","19.633N","19.633N",
                       "19.367N","18.933N","19.850N","19.700N","19.733N",
                       "18.750N","18.800N","18.767N","17.783N","18.033N",
                       "17.900N","18.267N","18.533N","18.700N","19.750N","19.667N",
                       "19.633N","19.883N","19.750N","19.367N","19.217N",
                       "19.217N","19.200N","18.417N","18.243N","18.667N",
                       "18.800N","18.717N","18.867N","18.617N","18.450N"),
          LONGITUD = c("71.683W","70.517W","70.267W",
                       "69.250W","69.417W","71.517W","71.850W","71.733W",
                       "68.700W","68.667W","68.367W","68.967W","70.733W",
                       "70.583W","70.533W","70.633W","69.900W","70.067W",
                       "69.833W","70.400W","71.633W","71.750W","71.433W",
                       "69.633W","69.783W","70.017W","71.367W","71.733W",
                       "71.233W","70.333W","70.500W","70.450W","70.833W","70.833W",
                       "70.583W","70.950W","70.550W","70.417W","69.600W",
                       "69.450W","69.333W","70.100W","70.061W","70.167W",
                       "71.233W","71.517W","71.517W","69.483W","69.300W"),
         ELEVACIÓN = c(890L,83L,15L,102L,3L,2L,
                       31L,9L,106L,54L,122L,23L,1164L,1141L,97L,529L,
                       15L,4L,3L,172L,7L,5L,24L,61L,56L,69L,3L,11L,3L,
                       60L,475L,678L,124L,310L,129L,4L,5L,196L,17L,4L,
                       7L,44L,36L,156L,415L,720L,430L,41L,3L)
)
colnames(afd_onamet_clim_func_2) <- nombres_columnas
afd_onamet_clim_func_3 <- data.frame(
  stringsAsFactors = FALSE,
               No. = c(68L, 69L, 70L, 71L, 72L, 73L, 74L, 75L, 76L),
          ESTACION = c("COTUI",
                       "SAN JOSE DE LAS MATAS","SANTIAGO","LAS AMERICAS","LA VICTORIA","HERRERA",
                       "SANTIAGO RODRIGUEZ","MONCION","MAO"),
         PROVINCIA = c("SANCHEZ RAMIREZ","SANTIAGO",
                       "SANTIAGO","SANTO DOMINGO ESTE","SANTO DOMINGO NORTE",
                       "SANTO DOMINGO OESTE","STGO RODRIGUEZ","STGO RODRIGUEZ",
                       "VALVERDE"),
           LATITUD = c("19.050N","19.333N","19.450N",
                       "18.433N","18.583N","18.467N","19.467N","19.400N",
                       "19.550N"),
          LONGITUD = c("70.150W","70.933W","70.700W",
                       "69.667W","69.833W","69.967W","71.333W","71.150W",
                       "71.067W"),
         ELEVACIÓN = c(60L, 523L, 183L, 17L, 12L, 61L, 129L, 366L, 78L)
)
colnames(afd_onamet_clim_func_3) <- nombres_columnas
afd_onamet_clim_func <- rbind(
  afd_onamet_clim_func_1,
  afd_onamet_clim_func_2,
  afd_onamet_clim_func_3)
afd_onamet_clim_func[, c('LONGITUD', 'LATITUD')] <- parse_lon_lat(
  afd_onamet_clim_func$LONGITUD,
  afd_onamet_clim_func$LATITUD)
```

<!-- #### sf -->

```{r, echo=F}
afd_onamet_clim_func_sf <- st_as_sf(
  afd_onamet_clim_func, coords = c('LONGITUD', 'LATITUD'), crs = 4326)
afd_onamet_clim_func_sf$tipo <- "Climáticas convencionales"
```

#### Mapa de estaciones climáticas convencionales ONAMET estudio AFD

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'gfm-yaml_metadata_block') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-climáticas-convencionales-estudio-afd)'`

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'latex') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-climáticas-convencionales-estudio-afd)'`

```{r, echo=F, fig.width=8, dpi=100, out.width="100%"}
fpal_tipo <- colorFactor(
  palette = RColorBrewer::brewer.pal(length(unique(afd_onamet_clim_func_sf$tipo)), 'Set1'),
  domain = unique(afd_onamet_clim_func_sf$tipo))
leaflet(afd_onamet_clim_func_sf) %>%
  addCircleMarkers(
    radius = 5, label = ~ `ESTACION`,
    color = ~ fpal_tipo(tipo),
    stroke = FALSE, fillOpacity = 0.8
  ) %>%
  addLegend(pal = fpal_tipo, values = ~ tipo, opacity = 1, title = "\"Estudio AFD\"<br>ONAMET") %>% 
  addTiles(group = 'OSM') %>%
  addProviderTiles("Esri.NatGeoWorldMap", group="ESRI Mapa") %>%
  addProviderTiles("Esri.WorldImagery", group="ESRI Imagen") %>%
  addProviderTiles("CartoDB.Positron", group= "CartoDB") %>%
  addLayersControl(
    baseGroups = c("OSM", "ESRI Mapa", "CartoDB", "ESRI Imagen"),
    position = 'bottomright',
    options = layersControlOptions(collapsed = FALSE)) %>% 
  setView(lat = 18.7, lng = -70.5, zoom = 7)
```

### Automáticas ONAMET

```{r, echo=F}
nombres_columnas <- c("No.", "ESTACION", "PROVINCIA", "LATITUD", "LONGITUD", "ESTADO")
afd_onamet_autom <- data.frame(
   stringsAsFactors = FALSE,
                No. = c(1L,2L,3L,4L,5L,6L,7L,
                        8L,9L,10L,11L,12L,13L,14L,15L,16L,17L,18L,19L,
                        20L,21L,22L,23L,24L,25L,26L,27L,28L,29L,30L),
             NOMBRE = c("Valle Nuevo","Los Montones",
                        "Monte Plata","Pimentel","San Juan","El Catey",
                        "Puerto Plata","Arroyo Barril","El Higüero (MDJB)",
                        "Sede ONAMET","La Romana (MDLR)","Sabana Larga",
                        "Isla Saona","Restauración","El Pozo","Higüey","Monte Cristi",
                        "Palo Verde","Luperón","Imbert","Nagua",
                        "Las Galeras","Hato Mayor","Azua","Neyba","Polo","Cabrera",
                        "Jimaní","Sabana de la Mar","Bayaguana"),
          PROVINCIA = c("La Vega","Santiago",
                        "Monte Plata","Duarte","San Juan de la Maguana","Samaná",
                        "Puerto Plata","Samaná","Santo Domingo Norte",
                        "Santo Domingo Este","La Romana","San José de Ocoa",
                        "La Altagracia","Dajabón","María T. Sánchez","Higüey",
                        "Monte Cristi","Monte Cristi","Puerto Plata","Puerto Plata",
                        "María T. Sánchez","Samaná","Hato Mayor","Azua",
                        "Bahoruco","Barahona","María T. Sánchez","Independencia",
                        "Hato Mayor","Monte Plata"),
            LATITUD = c(18.57627,18.12806,19.31511,
                        19.26036,18.78354,19.28875,18.8024,19.2105,
                        18.81512,19.26701,19.75708,19.2,18.56527,18.47332,18.4545,
                        18.62753,19.84997,19.74382,19.87407,19.75588,
                        19.36064,19.28957,18.77006,18.45306,18.48198,18.08739,
                        19.64436,18.49274,19.05266,18.74221),
           LONTIGUD = c(-70.50572,-68.72973,-71.689,
                        -69.88605,-70.64764,-70.92514,-69.78154,-70.11752,
                        -71.27745,-69.73368,-70.56897,-69.43166,-69.98858,
                        -69.87055,-68.91676,-68.69784,-71.65351,-71.57216,
                        -70.96508,-70.83061,-69.85213,-69.18798,-69.2556,
                        -70.75819,-71.32469,-71.2724,-69.90633,-71.85273,
                        -69.38885,-69.63078),
           ESTADO = c("2300 m  Activa",
                        "704 m  Activa","54 m  Activa","51.8 m  Activa","406 m  Activa",
                        "4 m  Activa","10 m  Activa","38 m  Activa",
                        "55 m  Activa","16 m  Activa","67 m  Activa",
                        "494 m  Inactiva","1 m  Inactiva","605 m  Inactiva","37 m  Inactiva",
                        "Instalada, no disponible","Instalada, no disponible",
                        "Instalada, no disponible","Instalada, no disponible",
                        "Instalada, no disponible","Instalada, no disponible",
                        "Instalada, no disponible","Instalada, no disponible",
                        "Instalada, no disponible","Instalada, no disponible",
                        "Instalada, no disponible","Instalada, no disponible",
                        "Instalada, no disponible","Instalada, no disponible",
                        "Instalada, no disponible")
)
colnames(afd_onamet_autom) <- nombres_columnas
afd_onamet_autom$ESTADO <- gsub('[0-9].*m  ', '', afd_onamet_autom$ESTADO)

# Conteos, proporciones
afd_onamet_autom_est_n <- table(afd_onamet_autom$ESTADO)
afd_onamet_autom_est_pct <- round(prop.table(afd_onamet_autom_est_n)*100, 2)
afd_onamet_autom$ESTADO <- factor(afd_onamet_autom$ESTADO,
       labels = c(
         paste0('Activa, ', afd_onamet_autom_est_n[[1]], ' (', afd_onamet_autom_est_pct[[1]], '%)'),
         paste0('Inactiva, ', afd_onamet_autom_est_n[[2]], ' (', afd_onamet_autom_est_pct[[2]], '%)'),
         paste0('Instalada, no disponible, ', afd_onamet_autom_est_n[[3]], ' (', afd_onamet_autom_est_pct[[3]], '%)')))
```

<!-- #### sf -->

```{r, echo=F}
afd_onamet_autom_sf <- st_as_sf(
  afd_onamet_autom, coords = c('LONGITUD', 'LATITUD'), crs = 4326)
```

#### Mapa de estaciones automáticas ONAMET estudio AFD

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'gfm-yaml_metadata_block') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-automáticas-onamet-estudio-afd)'`

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'latex') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-automáticas-onamet-estudio-afd)'`


```{r, echo=F, fig.width=8, dpi=100, out.width="100%"}
fpal_estado <- colorFactor(
  palette = RColorBrewer::brewer.pal(length(unique(afd_onamet_autom_sf$ESTADO)), 'Set1'),
  domain = unique(afd_onamet_autom_sf$ESTADO), reverse = T)
leaflet(afd_onamet_autom_sf) %>%
  addCircleMarkers(
    radius = 5,
    # label = ~ `ESTACION`,
    group = ~ ESTADO,
    color = ~ fpal_estado(ESTADO),
    stroke = FALSE, fillOpacity = 0.8
  ) %>%
  addLegend(pal = fpal_estado, values = ~ ESTADO, opacity = 1, title = "\"Estudio AFD\". ONAMET<br>Automáticas. ESTADO") %>% 
  addTiles(group = 'OSM') %>%
  addProviderTiles("Esri.NatGeoWorldMap", group="ESRI Mapa") %>%
  addProviderTiles("Esri.WorldImagery", group="ESRI Imagen") %>%
  addProviderTiles("CartoDB.Positron", group= "CartoDB") %>%
  addLayersControl(
    baseGroups = c("OSM", "ESRI Mapa", "CartoDB", "ESRI Imagen"),
    overlayGroups = ~ ESTADO, position = 'bottomright',
    options = layersControlOptions(collapsed = FALSE)) %>% 
  setView(lat = 18.7, lng = -70.5, zoom = 7)
```

### Climatológicas REDDOM

```{r, echo=F}
afd_reddom_clim <- data.frame(
  stringsAsFactors = FALSE,
              NUM. = c(1L,2L,3L,4L,5L,6L,7L,8L,
                       9L,10L,11L,12L,13L,14L,15L,16L,17L,18L,19L,
                       20L,21L,22L,23L,24L,25L,26L,27L,28L,29L,30L,31L,
                       32L,33L,34L,35L,36L),
            NOMBRE = c("Los_Tocones_Reddom",
                       "Agua_de_Luis_Reddom","Juliana_Jaramillo_Reddom",
                       "Esnamarena_Reddom","Unisa_Reddom","Agrofrontera_Reddom",
                       "Los_Montones_Reddom","Plan_Yaque_Manabao_Reddom",
                       "Ekoban1_Amina_Reddom","Banelino_Mao","Montecristi_Oficina_Banelino",
                       "Amina_Banelino","Judea_Nueva_Banamiel",
                       "Hatillo_Palma_Banelino","Novillero_Clay_REDDOM","Guananico_REDDOM",
                       "REDDOM1_Los Dajaos","La_Pita_REDDOM",
                       "Ucateci_LaVega_REDDOM","Las_Matas_de_Farfan_REDDOM","La_Cumbre_Reddom",
                       "Santiago_Apedi_Reddom","Cevicos_Reddom","Cimpa_Reddom",
                       "Conacado_Reddom","Sur_Futuro_Reddom","Barcelo_Reddom",
                       "Compadre_Pascual","Piedra_Blanca",
                       "Banamiel_Oficina_Reddom","Bananera_los_Rios","Chacuey_Reddom",
                       "Hato_al_Medio_Banelino","Jumunuco_REDDOM","La_Guama_Reddom",
                       "Puerto Plata_REDDOM"),
             LUGAR = c("Los Tocones, Santiago  Rodriguez","Agua de Luis, Montecristi",
                       "Juliana Jaramillo,  Montecristi","Jarabacoa, La Vega",
                       "La Herradura, Santiago","Martin Garcia,  Montecristi",
                       "Los Montones, San Jose  de Las Matas","Manabao, Jarabacoa",
                       "Amina, Valverde Mao","Mao, Valverde","Montecristi",
                       "Tierra Fria, Amina, Mao","Judea, Montecristi",
                       "Hatillo Palma,  Montecristi","Luperon, Puerto Plata","Guananico, Puerto Plata",
                       "Los Dajaos, Jarabacoa","La Pita, Jarabacoa",
                       "La Vega, UCATECI","Las Matas de Farfan, San  Juan",
                       "La Cumbre, Santiago","Parque, Santiago",
                       "Asociacion Pina, Cevicos,  Cotui","Villa Gonzalez, Santiago",
                       "Hernando Alonzo, Cotui","Padre Las Casas, Azua","Hato Mayor,","La Vega",
                       "La Vega","Hatillo de Palma,  Montecrisiti",
                       "Hatilo Palma,  Montecristi","Chacuey, Dajabon",
                       "Hato al Medio,  Montecristi","Jumunuco, Jarabacoa",
                       "La Guama, Cercado, San  Juan de la Maguana","Puerto Plata"),
           Latitud = c(19.50247,19.75922,19.78727,
                       19.1255,19.44292,19.60421,19.28876,19.07087,19.53784,
                       19.55873,19.84958,19.5451,19.70878,19.66124,
                       19.86363,19.73703,19.4059,19.00903,19.23312,18.87926,
                       19.54729,19.47227,19.00639,19.52976,19.04199,18.73675,
                       18.46267,19.5449,19.7532,19.66831,19.63595,19.50264,
                       19.67714,19.09705,18.71723,19.70652),
          Longitud = c(-71.34635,-71.21466,-71.6147,
                       -70.60576,-70.74848,-71.38353,-70.9251,-70.79701,
                       -70.98673,-71.09064,-71.64626,-70.96859,-71.65865,
                       -71.21455,-71.11765,-70.93845,-70.45344,-70.6336,
                       -70.5191,-71.54292,-70.62268,-70.70682,-69.97047,-70.84041,
                       -70.25831,-70.94145,-69.15753,-70.4521,-70.36341,
                       -71.19435,-71.19988,-71.5648,-71.31737,-70.7499,
                       -71.5016,-70.64679),
            Altura = c(122L,200L,20L,586L,181L,
                       79L,711L,909L,91L,107L,18L,101L,44L,56L,7L,205L,
                       962L,1203L,96L,435L,736L,159L,102L,101L,122L,
                       516L,108L,1011L,576L,91L,55L,133L,NA,1004L,800L,NA),
             Desde = c("1/9/2014","1/9/2014",
                       "1/8/2014","1/9/2014","1/9/2014","1/9/2014","1/10/2014",
                       "2/2/2015","1/1/2015","1/3/2016","1/3/2016","1/3/2016",
                       "1/6/2015","1/7/2015","1/3/2016","1/2/2016",
                       "1/5/2016","1/5/2016","1/7/2016","1/8/2016","1/2/2017",
                       "1/3/2017","1/3/2017","1/6/2017","1/6/2017","20/12/2017",
                       "28/8/2017","1/6/2016","1/9/2014",NA,NA,NA,NA,NA,
                       NA,NA),
             Hasta = c("31/3/2019","15/4/2019",
                       "15/4/2019","15/4/2019","15/4/2019","15/4/2019",
                       "15/4/2019","15/4/2019","28/2/2019","15/4/2019","15/4/2019",
                       "15/4/2019","15/4/2019","31/1/2019","15/4/2019",
                       "15/4/2019","31/3/2019","15/4/2019","15/4/2019","15/4/2019",
                       "15/4/2019","15/4/2019","15/4/2019","15/4/2019",
                       "15/4/2019","15/4/2019","26/1/2018","15/4/2019",
                       "15/4/2019",NA,NA,NA,NA,NA,NA,NA)
)

# Conteos, proporciones
afd_reddom_clim$ESTADO <- ifelse(is.na(afd_reddom_clim$Desde), 'No funcionando', 'Funcionando')
afd_reddom_clim_est_n <- table(afd_reddom_clim$ESTADO)
afd_reddom_clim_est_pct <- round(prop.table(afd_reddom_clim_est_n)*100, 2)
afd_reddom_clim$ESTADO <- factor(afd_reddom_clim$ESTADO,
       labels = c(
         paste0('Funcionando, ', afd_reddom_clim_est_n[[1]], ' (', afd_reddom_clim_est_pct[[1]], '%)'),
         paste0('No funcionando, ', afd_reddom_clim_est_n[[2]], ' (', afd_reddom_clim_est_pct[[2]], '%)')))
```


<!-- #### sf -->

```{r, echo=F}
afd_reddom_clim_sf <- st_as_sf(
  afd_reddom_clim, coords = c('Longitud', 'Latitud'), crs = 4326)
```

#### Mapa de estaciones climatológicas REDDOM estudio AFD

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'gfm-yaml_metadata_block') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-climatológicas-reddom-estudio-afd)'`

`r if(knitr::opts_knit$get("rmarkdown.pandoc.to") == 'latex') 'Versión interactiva del mapa, [aquí](https://geofis.github.io/datos-meteoclimaticos-escenarios-cc/consolidacion-lista-estaciones.html#mapa-de-estaciones-climatológicas-reddom-estudio-afd)'`


```{r, echo=F, fig.width=8, dpi=100, out.width="100%"}
fpal_estado2 <- colorFactor(
  palette = RColorBrewer::brewer.pal(length(unique(afd_reddom_clim_sf$ESTADO)), 'Set1'),
  domain = unique(afd_reddom_clim_sf$ESTADO), reverse = T)
leaflet(afd_reddom_clim_sf) %>%
  addCircleMarkers(
    radius = 5,
    label = ~ NOMBRE,
    group = ~ ESTADO,
    color = ~ fpal_estado2(ESTADO),
    stroke = FALSE, fillOpacity = 0.8
  ) %>%
  addLegend(pal = fpal_estado2, values = ~ ESTADO, opacity = 1, title = "\"Estudio AFD\". REDDOM<br>Climatológicas. ESTADO") %>% 
  addTiles(group = 'OSM') %>%
  addProviderTiles("Esri.NatGeoWorldMap", group="ESRI Mapa") %>%
  addProviderTiles("Esri.WorldImagery", group="ESRI Imagen") %>%
  addProviderTiles("CartoDB.Positron", group= "CartoDB") %>%
  addLayersControl(
    baseGroups = c("OSM", "ESRI Mapa", "CartoDB", "ESRI Imagen"),
    overlayGroups = ~ ESTADO, position = 'bottomright',
    options = layersControlOptions(collapsed = FALSE)) %>% 
  setView(lat = 18.7, lng = -70.5, zoom = 7)
```
